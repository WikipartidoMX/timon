<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html" 
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                template="../unaColumnaTemplate.xhtml">
    <ui:param name="donde" value="menuvotdeb" />
    <ui:define name="content">
        <link href="#{facesContext.externalContext.request.contextPath}/resources/css/votacion.css" rel="stylesheet" type="text/css" /> 
        <h:form id="formaNuevaVotacion">
            <div class="cajaTitulo" style="width: 650px;">
                <h1>Crea una nueva Votación</h1>
            </div>
            <div class="cajaContent" style="width: 650px;">
                <div style=" margin-top: 15px;">
                    <div class="campo">Título para la Votación</div>
                    <div class="valor">
                        <p:inputText size="30" id="nombre" required="true"  requiredMessage="Se requiere un título para la votación" style="font-size: 24px; color:grey;" value="#{vydc.nuevaVotacion.nombre}">
                            <f:ajax event="blur" render="errornombre"  />
                        </p:inputText><br/>
                        <h:message for="nombre" id="errornombre" style="color:red"/>
                    </div>
                </div>
                <div style=" margin-top: 15px;">
                    <div class="campo">Descripción</div>
                    <p:editor id="editor" value="#{vydc.nuevaVotacion.descripcion}" width="645" />
                </div>
                <div>
                    <div class="caja" style="float:left; width:285px;">
                        Clasificación de la votación: 
                        <br/><br/>
                        <p:tree value="#{vydc.raiz}" style="width:270px; "  var="node" id="tree" selection="#{vydc.selectedTema}" selectionMode="single">
                            <p:treeNode id="treenode">
                                #{node.nombre}
                            </p:treeNode>
                        </p:tree>
                        <div class="agregar">
                            <p:commandLink style="font-size:16px; text-decoration: none;"  value="&darr; AGREGAR &darr;" process="@this,tree"  action="#{vydc.agregarTema}" update="panelListaTemas" />
                        </div>
                        <h:panelGroup id="panelListaTemas">
                            <div class="headerTabla">La votación pertenece a estos temas:</div>
                            <div class="tabla">
                                <ui:repeat id="listaTemas" value="#{vydc.selecTemas}" var="tema">
                                    <div class="renglonTabla" onmouseover="$('#borraTema#{tema.id}').toggle();" onmouseout="$('#borraTema#{tema.id}').toggle();">
                                        <div style="float: left;">
                                            #{tema.nombre}
                                        </div>
                                        <div style="float: right;" >
                                            <p:commandLink action="#{vydc.borrarTema(tema)}" process="@this" update=":formaNuevaVotacion:panelListaTemas">
                                                <img style="display: none; cursor: pointer;" id="borraTema#{tema.id}" src="../images/borrar.png" />
                                            </p:commandLink>

                                        </div>
                                        <div style="clear:both;"/>
                                    </div>                                    
                                </ui:repeat>
                            </div>
                        </h:panelGroup>
                    </div>
                    <div class="caja" style="float:right; width:285px;"> 
                        Restringir a estos estados:
                        <br/><br/>
                        <div>
                            <div class="valor">

                                <p:selectOneListbox style="width: 280px; height: 200px;"    id="selectEstado"  value="#{vydc.estadoid}">
                                    <f:selectItems value="#{vydc.estados}" />
                                </p:selectOneListbox>

                            </div>
                        </div>
                        <div class="agregar">
                            <p:commandLink style="font-size:16px; text-decoration: none;"  value="&darr; AGREGAR &darr;" process="@this,selectEstado"  action="#{vydc.agregarEstado}" update="panelListaEstados" />
                        </div>
                        <h:panelGroup id="panelListaEstados">
                            <div class="headerTabla">Votación abierta a miembros de estos estados:</div>
                            <div class="tabla">
                                <ui:repeat id="listaEstados" value="#{vydc.selecEstados}" var="estado">
                                    <div class="renglonTabla" onmouseover="$('#borraEstado#{estado.id}').toggle();" onmouseout="$('#borraEstado#{estado.id}').toggle();">
                                        <div style="float: left;">
                                            #{estado.nombre}
                                        </div>
                                        <div style="float: right;" >
                                            <p:commandLink action="#{vydc.borrarEstado(estado)}" process="@this" update=":formaNuevaVotacion:panelListaEstados">
                                                <img style="display: none; cursor: pointer;" id="borraEstado#{estado.id}" src="../images/borrar.png" />
                                            </p:commandLink>

                                        </div>
                                        <div style="clear:both;"/>
                                    </div>
                                </ui:repeat>
                            </div>
                        </h:panelGroup>
                    </div>
                </div>
                <div style="clear: both;" />
                <div class="caja" style="width:600px;">
                    <h1>Ingresa las Opciones para la Votación</h1>
                    <div style=" margin-top: 15px;">
                        <div class="campo">Título de la Opción</div>
                        <div class="valor">
                            <p:inputText size="30" id="tituloOpcion" required="true"  requiredMessage="Se requiere un título para la opción" style="font-size: 24px; color:grey;" value="#{vydc.nuevaOpcion.nombre}">
                                <f:ajax event="blur" render="errortituloopcion"  />
                            </p:inputText><br/>
                            <h:message for="tituloOpcion" id="errortituloopcion" style="color:red"/>
                        </div>
                    </div>                    
                    <div style=" margin-top: 15px;">
                        <div class="campo">Descripción</div>
                        <p:editor id="editorOpcion" value="#{vydc.nuevaOpcion.descripcion}" width="600" />
                    </div>
                    <p:commandButton value="Agregar Opcion" 
                                     process="@this" 
                                     action="#{vydc.agregarOpcion}"
                                     update="panelListaOpciones,tituloOpcion,editorOpcion"
                                     />
                        <h:panelGroup id="panelListaOpciones">
                            <div class="headerTabla">Opciones para la votación:</div>
                            <div class="tabla">
                                <ui:repeat id="listaOpciones" value="#{vydc.opciones}" var="opcion" varStatus="x">
                                    <div class="renglonTabla" onmouseover="$('#borraOpcion#{x.index}').toggle();" onmouseout="$('#borraOpcion#{x.index}').toggle();">
                                        <div style="float: left;">
                                            #{opcion.nombre} #{x.index}
                                        </div>
                                        <div style="float: right;" >
                                            <p:commandLink action="#{vydc.borrarOpcion(x.index)}" process="@this" update=":formaNuevaVotacion:panelListaOpciones">
                                                <img style="display: none; cursor: pointer;" id="borraOpcion#{x.index}" src="../images/borrar.png" />
                                            </p:commandLink>

                                        </div>
                                        <div style="clear:both;"/>
                                    </div>
                                </ui:repeat>
                            </div>
                        </h:panelGroup>                    
                </div>
            </div>
            <p:messages />


        </h:form>

    </ui:define>



</ui:composition>
